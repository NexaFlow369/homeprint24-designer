<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>HomePrint24 – T-Shirt Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap');
    :root{
      --bg-dark:#0f172a;--bg-panel:#e5e7eb;--card:#f9fafb;
      --accent:#2563eb;--accent-soft:#dbeafe;--text-dark:#0f172a;--red:#ef4444;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg-dark);font-family:'Fjalla One',system-ui,sans-serif;color:#111}
    #hpt24{max-width:1180px;margin:24px auto;background:var(--bg-panel);padding:16px;border-radius:18px;box-shadow:0 16px 45px rgba(15,23,42,.45)}
    .title{text-align:center;margin:8px 0 16px;font-weight:800}
    .layout{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    .card{background:#fff;border-radius:14px;padding:14px;border:1px solid #e5e7eb}
    .btn{padding:8px 12px;border-radius:10px;border:0;background:#e5e7eb;font-weight:700;cursor:pointer}
    .btn.primary{background:#111827;color:#fff}
    .btn.accent{background:#0ea5e9;color:#fff}
    .row{display:flex;gap:8px;align-items:center}
    .col{display:flex;flex-direction:column;gap:8px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    canvas{width:100%;border-radius:14px;background:#f9fafb}
    .hint{font-size:12px;color:#64748b}
    .uploads .urow{display:grid;grid-template-columns:1.2fr auto auto auto auto;gap:6px;align-items:center}
    .total{font-weight:900}
    @media(max-width:900px){.layout{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div id="hpt24">
  <h2 class="title">HomePrint24 – T-Shirt Editor</h2>

  <div class="layout">
    <!-- LEFT -->
    <div class="col">
      <div class="card">
        <canvas id="cv" width="900" height="1100"></canvas>
        <p class="hint">Ziehen = Position · Scroll = Größe · Shift+Scroll = Rotation</p>
      </div>

      <div class="card">
        <div class="grid2">
          <div>
            <label>Skalierung <span id="sv">(100%)</span></label>
            <input id="scale" type="range" min="5" max="400" value="100">
          </div>
          <div>
            <label>Rotation <span id="rv">(0°)</span></label>
            <input id="rot" type="range" min="-180" max="180" value="0">
          </div>
        </div>
        <div class="row" style="justify-content:flex-end;margin-top:8px">
          <button id="vis" class="btn">Sichtbar</button>
          <button id="del" class="btn">Layer löschen</button>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="col">
      <div class="card uploads">
        <div class="row" style="justify-content:space-between">
          <strong>Upload (max. 3 Motive)</strong>
          <div class="row">
            <span id="view">FRONT</span>
            <button id="toggle" class="btn">Back</button>
          </div>
        </div>
        <div id="uplist" class="col"></div>
      </div>

      <div class="card">
        <div class="grid2">
          <select id="size">
            <option value="">Größe</option><option>XS</option><option>S</option><option>M</option>
            <option>L</option><option>XL</option><option>XXL</option>
          </select>
          <select id="quality">
            <option value="basic">Basic</option>
            <option value="standard" selected>Standard</option>
            <option value="premium">Premium</option>
          </select>
        </div>
        <div class="grid2" style="margin-top:8px">
          <input id="qty" type="number" min="1" value="1">
          <input id="price" readonly value="0,00 €">
        </div>
        <textarea id="notes" style="margin-top:8px" placeholder="Anmerkungen"></textarea>
        <div class="grid2" style="margin-top:8px">
          <button id="add" class="btn primary">In den Warenkorb</button>
          <button id="dl" class="btn">Mockup</button>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <strong>Warenkorb</strong>
          <span id="total" class="total">0,00 €</span>
        </div>
        <div id="cart" class="col" style="margin-top:8px"></div>
        <button id="checkout" class="btn accent" style="width:100%;margin-top:8px">Zur Kasse</button>
      </div>
    </div>
  </div>
</div>

<script>
(()=> {
  /* ===== PREISE ===== */
  const BASE={basic:9.49,standard:14.49,premium:24.49};
  const MOTIF={bw:3.5,color:5.5};

  /* ===== STATE ===== */
  const cv=document.getElementById('cv'),ctx=cv.getContext('2d');
  const L=3; const make=()=>({img:null,x:0,y:0,scale:1,rot:0,vis:true,bw:false,name:''});
  const F=Array.from({length:L},make),B=Array.from({length:L},make);
  let view='front',layers=F,active=0,cart=[];

  /* ===== HELPERS ===== */
  const fmt=n=>n.toLocaleString('de-DE',{style:'currency',currency:'EUR'});
  const countActive=()=> {
    let c=0; for(let i=0;i<L;i++){ if(F[i].img)c++; if(B[i].img)c++; } return c;
  };
  function motifStats(){
    let bw=0,color=0;
    for(let i=0;i<L;i++){
      const s=[]; if(F[i].img)s.push(F[i]); if(B[i].img)s.push(B[i]);
      if(s.length){ s.some(l=>l.bw)?bw++:color++; }
    }
    return {bw,color};
  }

  /* ===== DRAW ===== */
  function draw(){
    ctx.clearRect(0,0,cv.width,cv.height);
    const cx=cv.width/2,cy=cv.height*0.45;
    layers.forEach(LY=>{
      if(!LY.img||!LY.vis) return;
      ctx.save();
      ctx.translate(cx+LY.x,cy+LY.y);
      ctx.rotate(LY.rot*Math.PI/180);
      ctx.scale(LY.scale,LY.scale);
      ctx.drawImage(LY.img,-200,-200,400,400);
      ctx.restore();
    });
  }

  /* ===== UPLOADS ===== */
  const upl=document.getElementById('uplist');
  function renderUploads(){
    upl.innerHTML='';
    for(let i=0;i<L;i++){
      const r=document.createElement('div'); r.className='urow';
      r.innerHTML=`
        <input type="file" accept=".png,.jpg,.jpeg,.svg">
        <label><input type="checkbox"> S/W</label>
        <button class="btn">Aktiv</button>
        <button class="btn">Vis</button>
        <button class="btn">✖</button>`;
      upl.appendChild(r);
      const [f,cb,act,vis,del]=r.children;
      f.onchange=e=>{
        if(countActive()>=3){ alert('Maximal 3 Motive erlaubt'); f.value=''; return; }
        const file=e.target.files[0]; if(!file)return;
        const im=new Image(); im.onload=()=>{ layers[i]={img:im,x:0,y:0,scale:1,rot:0,vis:true,bw:layers[i].bw,name:file.name}; draw(); updatePrice(); };
        im.src=URL.createObjectURL(file);
      };
      cb.firstElementChild.onchange=()=>{ layers[i].bw=cb.firstElementChild.checked; updatePrice(); };
      act.onclick=()=>{ active=i; sync(); };
      vis.onclick=()=>{ if(layers[i].img){ layers[i].vis=!layers[i].vis; draw(); updatePrice(); } };
      del.onclick=()=>{ layers[i]=make(); draw(); updatePrice(); };
    }
  }

  /* ===== CONTROLS ===== */
  const scale=document.getElementById('scale'),sv=document.getElementById('sv');
  const rot=document.getElementById('rot'),rv=document.getElementById('rv');
  function sync(){
    const L=layers[active]; if(!L)return;
    scale.value=L.scale*100; sv.textContent=`(${Math.round(scale.value)}%)`;
    rot.value=L.rot; rv.textContent=`(${rot.value}°)`;
  }
  scale.oninput=()=>{ const L=layers[active]; if(!L||!L.img)return; L.scale=scale.value/100; sv.textContent=`(${scale.value}%)`; draw(); };
  rot.oninput=()=>{ const L=layers[active]; if(!L||!L.img)return; L.rot=+rot.value; rv.textContent=`(${rot.value}°)`; draw(); };
  document.getElementById('vis').onclick=()=>{ const L=layers[active]; if(L&&L.img){ L.vis=!L.vis; draw(); updatePrice(); } };
  document.getElementById('del').onclick=()=>{ layers[active]=make(); draw(); updatePrice(); };

  /* ===== VIEW ===== */
  document.getElementById('toggle').onclick=()=>{
    view=view==='front'?'back':'front';
    layers=view==='front'?F:B;
    document.getElementById('view').textContent=view.toUpperCase();
    active=0; renderUploads(); sync(); draw();
  };

  /* ===== PRICE ===== */
  const size=document.getElementById('size'),quality=document.getElementById('quality'),qty=document.getElementById('qty'),price=document.getElementById('price');
  function unitPrice(){
    const q=quality.value; const s=motifStats();
    return BASE[q]+s.bw*MOTIF.bw+s.color*MOTIF.color;
  }
  function updatePrice(){
    price.value=fmt(unitPrice()*Math.max(1,+qty.value||1));
  }
  qty.oninput=updatePrice; quality.onchange=updatePrice;

  /* ===== CART ===== */
  const cartBox=document.getElementById('cart'),total=document.getElementById('total');
  function renderCart(){
    cartBox.innerHTML=''; let sum=0;
    cart.forEach((it,i)=>{
      sum+=it.unit*it.qty;
      const d=document.createElement('div');
      d.innerHTML=`<strong>${it.name}</strong> · ${fmt(it.unit)} × ${it.qty} <button class="btn">✖</button>`;
      d.querySelector('button').onclick=()=>{ cart.splice(i,1); renderCart(); };
      cartBox.appendChild(d);
    });
    total.textContent=fmt(sum);
  }
  document.getElementById('add').onclick=()=>{
    const s=motifStats();
    cart.push({
      sku:'TSHIRT-CUSTOM',name:'T-Shirt Custom',
      size:size.value,quality:quality.value,qty:Math.max(1,+qty.value||1),
      motifs:s,uploadPrice:s.bw*MOTIF.bw+s.color*MOTIF.color,
      basePrice:BASE[quality.value],unit:unitPrice(),notes:document.getElementById('notes').value
    });
    renderCart(); updatePrice();
  };

  /* ===== CHECKOUT (GoDaddy MVP) ===== */
  document.getElementById('checkout').onclick=()=>{
    if(!cart.length){ alert('Warenkorb leer'); return; }
    const it=cart[0];
    const u=new URL('https://www.homeprint24.com/shop/ols/cart');
    u.searchParams.set('product',it.sku);
    u.searchParams.set('qty',it.qty);
    u.searchParams.set('price',it.unit.toFixed(2));
    u.searchParams.set('options',JSON.stringify(it));
    window.location.href=u.toString();
  };

  /* ===== MOCKUP ===== */
  document.getElementById('dl').onclick=()=>{
    const a=document.createElement('a');
    a.download='HP24_TShirt.png'; a.href=cv.toDataURL('image/png'); a.click();
  };

  /* INIT */
  renderUploads(); sync(); updatePrice(); draw();
})();
</script>
</body>
</html>
