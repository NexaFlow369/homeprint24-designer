<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>HomePrint24 ‚Äì 3D Hoodie Editor (FIXED)</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap');


    /* ==========================================================
       üö® GO DADDY FIXES ‚Äì GEGEN SHRINK, SCALE, RESPONSIVE BUGS
       ========================================================== */

    /* GoDaddy skaliert Custom-Code ‚Üí deaktivieren */
    #hpt24, 
    #hpt24 * {
      transform: none !important;
      zoom: 1 !important;
    }

    /* GoDaddy erzeugt einen Framework-Container ‚Üí Breite fixen */
    div[data-testid],
    div[class*="responsive"],
    div[class*="responsive"] *,
    div[class*="layout"],
    div[class*="column"],
    div[class*="section"] {
      max-width: 100% !important;
      width: 100% !important;
    }

    /* Cart schrumpft ‚Üí erzwingen */
    .ld-cart-card,
    .ld-cart-row,
    #ld-cart,
    #ld-total {
      transform: scale(1) !important;
      zoom: 1 !important;
      max-width: 100% !important;
      width: 100% !important;
    }

    /* Cart-Row Grid erzwingen */
    .ld-cart-row {
      width: 100% !important;
      grid-template-columns: minmax(0, 1.7fr) auto auto auto !important;
    }

    /* Canvas darf nicht schrumpfen */
    #ld-canvas {
      max-width: 100% !important;
      width: 100% !important;
      transform: none !important;
    }

    /* Editor Hauptcontainer */
    #hpt24 {
      max-width: 1180px !important;
      width: 100% !important;
      margin: 24px auto !important;
    }



    /* ==========================================================
       üß© ORIGINAL EDITOR DESIGN (unver√§ndert)
       ========================================================== */

    :root{
      --bg-dark:#0f172a;
      --bg-panel:#e5e7eb;
      --card:#f9fafb;
      --accent:#2563eb;
      --accent-soft:#dbeafe;
      --text-dark:#0f172a;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      padding:0;
      background:var(--bg-dark);
      color:var(--bg-panel);
      font-family:'Fjalla One',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
    }

    #hpt24{
      background:var(--bg-panel);
      padding:16px;
      border-radius:18px;
      box-shadow:0 16px 45px rgba(15,23,42,.45);
    }

    .hpt24-title{
      text-align:center;
      margin:8px 0 16px;
      color:#0f172a;
      font-weight:800;
      letter-spacing:.3px;
    }

    #hpt24-tabs{
      display:flex;
      justify-content:center;
      margin-bottom:12px;
      gap:8px;
    }
    .ld-tab{
      padding:8px 16px;
      border-radius:999px;
      border:1px solid #cbd5e1;
      background:#fff;
      cursor:pointer;
      font-size:12px;
      font-weight:700;
    }
    .ld-tab.active{
      background:#111827;
      color:#fff;
      border-color:#111827;
    }

    .hpt24-layout{
      display:grid;
      grid-template-columns:minmax(0,1.25fr) minmax(0,1.15fr);
      gap:18px;
      align-items:flex-start;
    }

    .hpt24-left,
    .hpt24-right{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .hpt24-right{
      border-left:1px solid #d1d5db;
      padding-left:14px;
    }

    .ld-card{
      background:var(--card);
      border-radius:14px;
      padding:14px;
      border:1px solid #e5e7eb;
    }

    .ld-label{
      font-weight:800;
      color:var(--text-dark);
      margin-bottom:4px;
    }
    .ld-sublabel{
      font-weight:600;
      color:var(--text-dark);
      font-size:13px;
    }

    .ld-input{
      padding:10px;
      border-radius:10px;
      border:1px solid #cbd5e1;
      width:100%;
      background:#fff;
      font-size:13px;
    }

    .ld-btn{
      padding:7px 10px;
      border:none;
      border-radius:9px;
      background:#e2e8f0;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
    }
    .ld-btn.primary{
      background:#111827;
      color:#fff;
      font-weight:800;
    }
    .ld-btn.accent{
      background:#0ea5e9;
      color:#fff;
      font-weight:800;
    }

    .hpt24-grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .hpt24-gap-top{margin-top:8px;}

    /* PREVIEW / CANVAS */
    .ld-preview-shell{
      position:relative;
      background:#ffffff;
      border-radius:18px;
      box-shadow:0 12px 32px rgba(15,23,42,.18);
      padding:10px 10px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    #ld-canvas{
      width:100%;
      display:block;
      border-radius:16px;
      background:#f9fafb;
    }

    .ld-preview-hint{
      position:absolute;
      left:16px;
      bottom:18px;
      background:rgba(15,23,42,.84);
      color:#fff;
      padding:6px 10px;
      border-radius:8px;
      font-size:11px;
    }

    .ld-color-bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:#f9fafb;
      border-radius:999px;
      padding:6px 10px;
      border:1px solid #e5e7eb;
    }
    .ld-swatches-row{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .ld-swatch{
      width:22px;
      height:22px;
      border-radius:6px;
      border:1px solid #d1d5db;
      cursor:pointer;
    }

    /* LAYER */
    .ld-layer-card{margin-top:4px;}
    .hpt24-preset-wrap{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .hpt24-preset-row{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    .hpt24-range{width:100%;}
    .hpt24-subval{font-size:12px;color:#64748b;}

    .hpt24-layer-buttons{
      display:flex;
      justify-content:flex-end;
      align-items:flex-end;
      gap:6px;
      margin-top:8px;
    }
    .hpt24-small-btn{padding:5px 8px;font-size:11px;}

    .hpt24-row-between{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .hpt24-upload-list{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:8px;
    }
    .ld-upload-row{
      display:grid;
      grid-template-columns:minmax(0,1.7fr) auto auto auto auto;
      gap:4px;
      align-items:center;
    }
    .hpt24-sw-toggle{
      font-size:10px;
      display:flex;
      align-items:center;
      gap:4px;
    }

    /* QUALITY */
    .ld-quality-wrap{margin-top:0;}
    .quality-row{display:flex;gap:6px;}
    .q-btn{
      padding:6px 10px;
      font-size:12px;
      border-radius:999px;
      border:1px solid #cbd5e1;
      background:#fff;
      cursor:pointer;
      font-weight:700;
    }
    .q-btn.active{
      background:#111827;
      color:#fff;
      border-color:#111827;
    }

    /* CART */
    .ld-cart-card{
      margin:6px auto 0;
      border-top:2px solid #0f172a;
      box-shadow:0 6px 18px rgba(15,23,42,.12);
      padding-top:10px;
      width:100%;
    }
    .ld-cart-row{
      display:grid;
      grid-template-columns:minmax(0,1.7fr) auto auto auto;
      gap:8px;
      align-items:center;
      background:#e5e7eb;
      border-radius:12px;
      padding:8px;
      border:1px solid #d1d5db;
      width:100%;
    }
    .ld-cart-row .ld-chip{
      padding:1px 8px;
      border-radius:999px;
      border:1px solid #cbd5e1;
      background:#fff;
      font-size:10px;
      margin-left:4px;
    }
    .hpt24-total{font-weight:800;color:#0f172a;}
    .hpt24-cart-list{margin-top:8px;display:flex;flex-direction:column;gap:8px;width:100%;}
    .hpt24-checkout-btn{margin-top:10px;width:100%;}

    .hpt24-hint-text{
      font-size:11px;
      color:#64748b;
      margin-top:6px;
      line-height:1.4;
    }

    .hpt24-footer{
      text-align:center;
      font-size:12px;
      color:#64748b;
      margin-top:10px;
    }

    @media(max-width:900px){
      .hpt24-layout{
        grid-template-columns:1fr;
      }
      .hpt24-right{
        border-left:none;
        padding-left:0;
      }
    }

  </style>
</head>

<body>
<div id="hpt24">
  <h2 class="hpt24-title">HomePrint24 ‚Äì Print Your Legacy</h2>

  <div id="hpt24-tabs">
    <button class="ld-tab active" data-prod="hoodie">Hoodie</button>
  </div>

  <div class="hpt24-layout">

    <!-- LEFT -->
    <div class="hpt24-left">

      <div class="ld-preview-shell">
        <canvas id="ld-canvas" width="900" height="1100"></canvas>
        <div class="ld-preview-hint">
          Ziehen = Position ‚Ä¢ Mausrad = Gr√∂√üe ‚Ä¢ Shift + Scroll = Rotation
        </div>

        <div class="ld-color-bar">
          <span class="ld-sublabel">Farbe</span>
          <div id="ld-swatches" class="ld-swatches-row"></div>
        </div>
      </div>

      <!-- PRESETS -->
      <div class="ld-card ld-layer-card">

        <div class="hpt24-grid-2 hpt24-gap-top">
          <div>
            <div class="hpt24-preset-wrap">
              <span class="ld-sublabel">Preset:</span>
              <div class="hpt24-preset-row">
                <button class="ld-btn" data-preset="center">Center</button>
                <button class="ld-btn" data-preset="back">Back-Tag</button>
              </div>
            </div>
          </div>

          <div>
            <label class="ld-sublabel">
              Skalierung <span id="ld-scale-val">(100%)</span>
            </label>
            <input id="ld-scale" type="range" min="5" max="400" value="100" class="hpt24-range">
          </div>
        </div>

        <div class="hpt24-grid-2 hpt24-gap-top">
          <div>
            <label class="ld-sublabel">
              Rotation <span id="ld-rot-layer-val">(0¬∞)</span>
            </label>
            <input id="ld-rot-layer" type="range" min="-180" max="180" value="0" class="hpt24-range">
          </div>

          <div>
            <label class="ld-sublabel">
              Deckkraft <span id="ld-opa-val">(100%)</span>
            </label>
            <input id="ld-opa" type="range" min="5" max="100" value="100" class="hpt24-range">
          </div>
        </div>

        <div class="hpt24-layer-buttons">
          <button id="ld-layer-vis" class="ld-btn hpt24-small-btn">Sichtbar: AN</button>
          <button id="ld-layer-del" class="ld-btn hpt24-small-btn">Layer l√∂schen</button>
        </div>

      </div>
    </div>


    <!-- RIGHT -->
    <div class="hpt24-right">

      <div class="ld-card">
        <div class="hpt24-row-between">
          <label class="ld-label">Dein Motiv hochladen</label>
          <div class="hpt24-row-between" style="gap:6px;">
            <span class="ld-sublabel">Ansicht:</span>
            <span id="ld-view-badge" class="ld-sublabel">FRONT</span>
            <button id="ld-toggle-back" class="ld-btn">Back</button>
          </div>
        </div>
        <div id="ld-uploader-list" class="hpt24-upload-list"></div>
      </div>

      <div class="ld-card">
        <label class="ld-label">Bestellangaben</label>

        <div class="hpt24-grid-2 hpt24-gap-top">
          <select id="ld-size" class="ld-input">
            <option value="">Gr√∂√üe w√§hlen</option>
            <option>XS</option><option>S</option><option>M</option>
            <option>L</option><option>XL</option><option>XXL</option><option>3XL</option>
          </select>
          <select id="ld-color-select" class="ld-input"></select>
        </div>

        <div class="hpt24-grid-2 hpt24-gap-top">
          <div class="ld-quality-wrap">
            <label class="ld-sublabel">Qualit√§t</label>
            <div class="quality-row">
              <button class="q-btn active" data-q="standard">Standard Hoodie</button>
              <button class="q-btn" data-q="premium">Premium Hoodie</button>
            </div>
          </div>

          <select id="ld-gender" class="ld-input">
            <option value="">Passform w√§hlen</option>
            <option value="unisex">Unisex</option>
            <option value="man">Mann</option>
            <option value="woman">Frau</option>
          </select>
        </div>

        <select id="ld-quality" style="display:none;">
          <option value="standard">standard</option>
          <option value="premium">premium</option>
        </select>

        <div class="hpt24-gap-top">
          <label class="ld-sublabel">St√ºckzahl & Preis</label>
          <div class="hpt24-grid-2 hpt24-gap-top">
            <input id="ld-qty" type="number" min="1" value="1" class="ld-input">
            <input id="ld-price" type="text" class="ld-input" value="0,00 ‚Ç¨" readonly>
          </div>
        </div>

        <div class="hpt24-gap-top">
          <label class="ld-sublabel">Promocode</label>
          <input id="ld-promocode" class="ld-input">
          <p id="promo-hint" style="display:none;">Rabatt angewendet.</p>
        </div>

        <textarea id="ld-notes" class="ld-input hpt24-notes"
          placeholder="W√ºnsche/Anmerkungen"></textarea>

        <div class="hpt24-grid-2 hpt24-gap-top">
          <button id="ld-add" class="ld-btn primary">In den Warenkorb</button>
          <button id="ld-download" class="ld-btn">Mockup herunterladen</button>
        </div>
      </div>

      <div class="ld-card ld-cart-card">
        <div class="hpt24-row-between">
          <div class="ld-label">Warenkorb</div>
          <div id="ld-total" class="hpt24-total">0,00 ‚Ç¨</div>
        </div>
        <div id="ld-cart" class="hpt24-cart-list"></div>
        <button id="ld-checkout" class="ld-btn accent hpt24-checkout-btn">Zur Kasse</button>

        <p class="hpt24-hint-text">
          Der Preis basiert auf Hoodie-Qualit√§t, Farbe & Druck.
        </p>
      </div>

    </div>
  </div>

  <p class="hpt24-footer">¬© HomePrint24 ‚Äì Print Your Legacy</p>
</div>

<!-- BLOCK 2 kommt unten -->
</body>
</html>
<script>
(function(){

  /* ==========================================================
     PREISE
  ========================================================== */
  const BASE_PRICE = {
    standard: 29.49,
    premium:  39.49
  };

  const MOTIF_PRICE = { bw:3.50, color:5.50 };


  /* ==========================================================
     PALETTEN NACH QUALIT√ÑT (A = strikt getrennt)
  ========================================================== */

  // Standard Hoodie Farben
  const COLORS_STANDARD = [
    'white','navy','green','red','yellow','black','blue'
  ];

  // Premium Hoodie Farben
  const COLORS_PREMIUM = [
    'black','lightgrey','navy','egret'
  ];

  const COLOR_NAME = {
    white:'White',
    navy:'Navy Blue',
    green:'Green',
    red:'Red',
    yellow:'Yellow',
    black:'Black',
    blue:'Blue',
    lightgrey:'Light Grey',
    egret:'Egret'
  };

  const COLOR_HEX = {
    white:'#ffffff',
    navy:'#1e3a8a',
    green:'#16a34a',
    red:'#dc2626',
    yellow:'#facc15',
    black:'#020617',
    blue:'#2563eb',
    lightgrey:'#d1d5db',
    egret:'#f5f5ee'
  };

  function currentPalette(quality){
    return (quality === 'premium') ? COLORS_PREMIUM : COLORS_STANDARD;
  }


  /* ==========================================================
     HOODIE STANDARD BILDER
  ========================================================== */

  const FRONT_STANDARD = {
    navy:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Navy%20Blue%20Front-1122bfa.jpg/:/rs=w:1440,h:1440",
    green:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Green%20Front-e577a96.jpg/:/rs=w:1440,h:1440",
    red:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Red%20Front-d478713.jpg/:/rs=w:1440,h:1440",
    yellow:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Yellow%20Front-1e87d95.jpg/:/rs=w:1440,h:1440",
    black:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Black%20Front-650fe0d.jpg/:/rs=w:1440,h:1440",
    blue:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Blue%20Front-5383a24.jpg/:/rs=w:1440,h:1440",
    white:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/White%20Front-bd916f8.jpg/:/rs=w:1440,h:1440"
  };

  const BACK_STANDARD = {
    navy:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Navy%20Blue%20Back-5c1d078.jpg/:/rs=w:1440,h:1440",
    green:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Green%20Back-a108fa9.jpg/:/rs=w:1440,h:1440",
    red:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Red%20Back-d478713.jpg/:/rs=w:1440,h:1440",
    yellow:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Yellow%20BAck-97ed380.jpg/:/rs=w:1440,h:1440",
    black:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Black%20Back-1c2b6bf.jpg/:/rs=w:1440,h:1440",
    blue:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Blue%20Back-650fe0d.jpg/:/rs=w:1440,h:1440",
    white:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/White%20Back-33702e4.jpg/:/rs=w:1440,h:1440"
  };


  /* ==========================================================
     HOODIE PREMIUM BILDER
  ========================================================== */

  const FRONT_PREMIUM = {
    black:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Black%20Front-0c42c29.jpg/:/rs=w:1440,h:1440",
    lightgrey:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Light%20Grey%20Front.jpg/:/rs=w:1440,h:1440",
    navy:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Navy%20Blue%20Front-35e928c.jpg/:/rs=w:1440,h:1440",
    egret:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Egret%20Front.jpg/:/rs=w:1440,h:1440"
  };

  const BACK_PREMIUM = {
    black:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Black%20Back-b91e203.jpg/:/rs=w:1440,h:1440",
    lightgrey:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Light%20Grey%20Back.jpg/:/rs=w:1440,h:1440",
    navy:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Navy%20Blue%20Back-c1c046f.jpg/:/rs=w:1440,h:1440",
    egret:"https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/Egret%20Back.jpg/:/rs=w:1440,h:1440"
  };


  /* ==========================================================
     IMAGE CACHE
  ========================================================== */

  const CACHE = {};
  function loadImage(src){
    if(CACHE[src]) return CACHE[src];
    const im=new Image();
    im.crossOrigin='anonymous';
    im.src=src;
    CACHE[src]=im;
    im.onload=()=>draw();
    return im;
  }


  /* ==========================================================
     STATE
  ========================================================== */

  const canvas=document.getElementById('ld-canvas');
  const ctx=canvas.getContext('2d');

  let view='front';
  let selectedQuality='standard';
  let color='white'; // STARTFARBE
  let promoDiscount=0;

  const LAYERS = 3;
  const makeLayer = () => ({
    img:null,x:0,y:0,scale:1,rot:0,op:1,vis:true,bw:false,name:''
  });

  const layersFront=Array.from({length:LAYERS},makeLayer);
  const layersBack =Array.from({length:LAYERS},makeLayer);
  let layers=layersFront;
  let active=0;


  /* ==========================================================
     DOM ELEMENTS
  ========================================================== */

  const colorSel=document.getElementById('ld-color-select');
  const sizeEl=document.getElementById('ld-size');
  const qtyEl=document.getElementById('ld-qty');
  const priceEl=document.getElementById('ld-price');
  const viewBadge=document.getElementById('ld-view-badge');
  const toggleBack=document.getElementById('ld-toggle-back');
  const uploadsBox=document.getElementById('ld-uploader-list');
  const qualityEl=document.getElementById('ld-quality');

  const promoInput=document.getElementById('ld-promocode');
  const promoHint=document.getElementById('promo-hint');

  const scaleEl=document.getElementById('ld-scale');
  const scaleVal=document.getElementById('ld-scale-val');
  const rotEl=document.getElementById('ld-rot-layer');
  const rotVal=document.getElementById('ld-rot-layer-val');
  const opaEl=document.getElementById('ld-opa');
  const opaVal=document.getElementById('ld-opa-val');

  const visBtn=document.getElementById('ld-layer-vis');
  const delBtn=document.getElementById('ld-layer-del');

  const cartBox=document.getElementById('ld-cart');
  const totalEl=document.getElementById('ld-total');
  const genderEl=document.getElementById('ld-gender');

  const cart=[];


  /* ==========================================================
     FARBAUSWAHL RENDERING (A)
  ========================================================== */

  function renderColorSelect(){
    colorSel.innerHTML='';
    const list=currentPalette(selectedQuality);

    list.forEach(k=>{
      const opt=document.createElement('option');
      opt.value=k;
      opt.textContent=COLOR_NAME[k];
      colorSel.appendChild(opt);
    });

    if(!list.includes(color)){
      color='white';
    }
    colorSel.value=color;
  }

  function renderSwatches(){
    const row=document.getElementById('ld-swatches');
    row.innerHTML='';
    const list=currentPalette(selectedQuality);

    list.forEach(k=>{
      const sw=document.createElement('div');
      sw.className='ld-swatch';
      sw.style.background=COLOR_HEX[k];

      if(k===color){
        sw.style.outline='2px solid #111827';
        sw.style.outlineOffset='1px';
      }

      sw.onclick=()=>{
        color=k;
        renderColorSelect();
        draw();
      };

      row.appendChild(sw);
    });
  }


  /* ==========================================================
     VIEW SWITCH
  ========================================================== */

  function setView(v){
    view=(v==='back')?'back':'front';
    layers=(view==='front')?layersFront:layersBack;
    viewBadge.textContent=view.toUpperCase();
    active=0;
    renderUploadRows();
    syncUI();
    draw();
  }

  toggleBack.onclick=()=> setView(view==='front'?'back':'front');


  /* ==========================================================
     BASE IMAGE
  ========================================================== */

  function getBaseImage(){
    let src=null;

    if(selectedQuality==='standard'){
      src=(view==='front')?FRONT_STANDARD[color]:BACK_STANDARD[color];
    } else {
      src=(view==='front')?FRONT_PREMIUM[color]:BACK_PREMIUM[color];
    }

    return loadImage(src);
  }


  /* ==========================================================
     DRAW
  ========================================================== */

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const base=getBaseImage();
    if(!base||!base.width) return;

    const marginX=canvas.width*0.08;
    const marginY=canvas.height*0.06;

    const maxW=canvas.width-marginX*2;
    const maxH=canvas.height-marginY*2;
    const ratio=base.height/base.width;

    let W=maxW;
    let H=W*ratio;

    if(H>maxH){
      H=maxH;
      W=H/ratio;
    }

    const sx=(canvas.width-W)/2;
    const sy=(canvas.height-H)/2;

    ctx.drawImage(base,sx,sy,W,H);

    const cx=canvas.width/2;
    const cy=sy+H*0.40;

    layers.forEach(L=>{
      if(!L.img||!L.vis) return;
      const iw=canvas.width*0.38;
      const ih=iw*(L.img.naturalHeight/L.img.naturalWidth);

      ctx.save();
      ctx.translate(cx+L.x, cy+L.y);
      ctx.rotate(L.rot*Math.PI/180);
      ctx.scale(L.scale,L.scale);
      ctx.globalAlpha=L.op;

      ctx.drawImage(L.img,-iw/2,-ih/2,iw,ih);

      ctx.restore();
    });
  }


  /* ==========================================================
     UPLOAD LIST
  ========================================================== */

  function renderUploadRows(){
    uploadsBox.innerHTML='';

    for(let i=0;i<LAYERS;i++){
      const row=document.createElement('div');
      row.className='ld-upload-row';

      row.innerHTML=`
        <div><input type="file" id="ld-file-${i}" class="ld-input" accept="image/*"></div>
        <label class="hpt24-sw-toggle">
          <input type="checkbox" data-bw="${i}"> S/W 3,50 ‚Ç¨
        </label>
        <button class="ld-btn" data-act="${i}">Aktiv</button>
        <button class="ld-btn" data-vis="${i}">${layers[i].vis?'üëÅ AUS':'üëÅ AN'}</button>
        <button class="ld-btn" data-del="${i}">‚úñ</button>
      `;

      uploadsBox.appendChild(row);

      const inp=row.querySelector(`#ld-file-${i}`);
      inp.onchange=e=>{
        const f=e.target.files[0];
        if(!f) return;
        const url=URL.createObjectURL(f);
        const im=new Image();
        im.onload=()=>{
          layers[i]={
            img:im,x:0,y:0,scale:1,rot:0,op:1,vis:true,bw:false,name:f.name
          };
          active=i;
          renderUploadRows();
          syncUI();
          draw();
          updatePrice();
        };
        im.src=url;
      };

      const bw=row.querySelector(`[data-bw="${i}"]`);
      bw.checked=layers[i].bw;
      bw.onchange=()=>{
        layers[i].bw=bw.checked;
        updatePrice();
      };

      row.querySelector(`[data-act="${i}"]`).onclick=()=>{
        active=i;
        syncUI();
        renderUploadRows();
      };

      row.querySelector(`[data-vis="${i}"]`).onclick=()=>{
        if(!layers[i].img) return;
        layers[i].vis=!layers[i].vis;
        renderUploadRows();
        syncUI();
        draw();
        updatePrice();
      };

      row.querySelector(`[data-del="${i}"]`).onclick=()=>{
        layers[i]=makeLayer();
        if(active===i) active=Math.max(0,active-1);
        renderUploadRows();
        syncUI();
        draw();
        updatePrice();
      };
    }
  }


  /* ==========================================================
     PRESETS
  ========================================================== */

  document.querySelectorAll('[data-preset]').forEach(btn=>{
    btn.onclick=()=>{
      const L=layers[active];
      if(!L.img) return;

      if(btn.dataset.preset==='center'){
        L.x=0; L.y=0; L.scale=1;
      }
      if(btn.dataset.preset==='back'){
        L.x=0; L.y=-canvas.height*0.18; L.scale=0.8;
      }

      syncUI();
      draw();
    };
  });


  /* ==========================================================
     UI SYNC
  ========================================================== */

  function syncUI(){
    const L=layers[active];
    const scaleP=Math.round(L.scale*100);
    scaleEl.value=scaleP;
    scaleVal.textContent=`(${scaleP}%)`;

    rotEl.value=Math.round(L.rot);
    rotVal.textContent=`(${rotEl.value}¬∞)`;

    const opaP=Math.round(L.op*100);
    opaEl.value=opaP;
    opaVal.textContent=`(${opaP}%)`;

    visBtn.textContent='Sichtbar: '+(L.vis?'AN':'AUS');
  }

  scaleEl.oninput=()=>{
    const L=layers[active];
    if(!L.img) return;
    L.scale=scaleEl.value/100;
    syncUI();
    draw();
  };

  rotEl.oninput=()=>{
    const L=layers[active];
    if(!L.img) return;
    L.rot=parseInt(rotEl.value);
    syncUI();
    draw();
  };

  opaEl.oninput=()=>{
    const L=layers[active];
    if(!L.img) return;
    L.op=opaEl.value/100;
    syncUI();
    draw();
  };

  visBtn.onclick=()=>{
    const L=layers[active];
    if(!L.img) return;
    L.vis=!L.vis;
    syncUI();
    renderUploadRows();
    draw();
    updatePrice();
  };

  delBtn.onclick=()=>{
    layers[active]=makeLayer();
    syncUI();
    renderUploadRows();
    draw();
    updatePrice();
  };


  /* ==========================================================
     DRAGGING
  ========================================================== */

  let dragging=false;
  let last={x:0,y:0};

  function getPos(e){
    const r=canvas.getBoundingClientRect();
    return {
      x:(e.clientX-r.left)*(canvas.width/r.width),
      y:(e.clientY-r.top)*(canvas.height/r.height)
    };
  }

  canvas.onmousedown=e=>{
    dragging=true;
    last=getPos(e);
  };

  window.onmouseup=()=> dragging=false;

  canvas.onmousemove=e=>{
    if(!dragging) return;
    const p=getPos(e);
    const dx=p.x-last.x;
    const dy=p.y-last.y;

    const L=layers[active];
    if(L&&L.img){
      L.x+=dx;
      L.y+=dy;
      draw();
    }
    last=p;
  };

  canvas.onwheel=e=>{
    const L=layers[active];
    if(!L.img) return;
    e.preventDefault();

    if(e.shiftKey){
      L.rot -= Math.sign(e.deltaY)*4;
    } else {
      let next=L.scale*100 - Math.sign(e.deltaY)*6;
      next=Math.max(5,Math.min(400,next));
      L.scale=next/100;
    }
    syncUI();
    draw();
  };


  /* ==========================================================
     PREISKALKULATION
  ========================================================== */

  function motifStats(){
    let bw=0,colorCnt=0;

    for(let i=0;i<LAYERS;i++){
      const F=layersFront[i], B=layersBack[i];
      const hasFront=(F&&F.img&&F.vis);
      const hasBack =(B&&B.img&&B.vis);
      const has = hasFront||hasBack;

      if(!has) continue;

      const isBw=(hasFront && F.bw) || (hasBack && B.bw);
      if(isBw) bw++;
      else colorCnt++;
    }

    return {bw,color:colorCnt};
  }

  function computeUnitPrice(){
    const base=BASE_PRICE[selectedQuality];
    const {bw,color} = motifStats();
    let price=base + bw*MOTIF_PRICE.bw + color*MOTIF_PRICE.color;

    if(promoDiscount>0) price -= price*promoDiscount;
    return price;
  }

  function fmt(n){
    return n.toLocaleString('de-DE',{style:'currency',currency:'EUR'});
  }

  function updatePrice(){
    const qty=Math.max(1,parseInt(qtyEl.value||'1'));
    priceEl.value=fmt(computeUnitPrice()*qty);
  }

  qtyEl.oninput=updatePrice;


  /* ==========================================================
     QUALIT√ÑTSWECHSEL (A-LOGIK)
  ========================================================== */

  document.querySelectorAll('.q-btn').forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll('.q-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');

      selectedQuality=btn.dataset.q;
      qualityEl.value=selectedQuality;

      promoDiscount=0;
      promoInput.value='';
      promoHint.style.display='none';

      // Farbe resetten
      if(selectedQuality==='standard'){
        if(!COLORS_STANDARD.includes(color)) color='white';
      } else {
        if(!COLORS_PREMIUM.includes(color)) color='black';
      }

      renderColorSelect();
      renderSwatches();
      draw();
      updatePrice();
    };
  });


  /* ==========================================================
     PROMOCODE
  ========================================================== */

  promoInput.oninput=()=>{
    const code=promoInput.value.trim().toLowerCase();
    promoDiscount=0;
    promoHint.style.display='none';

    if(code==='hp24-10') promoDiscount=0.10;
    if(code==='hp24-20') promoDiscount=0.20;
    if(code==='free')    promoDiscount=1.00;

    if(promoDiscount>0) promoHint.style.display='block';

    updatePrice();
  };


  /* ==========================================================
     WARENKORB
  ========================================================== */

  function renderCart(){
    cartBox.innerHTML='';
    let sum=0;

    cart.forEach((item,i)=>{
      sum+=item.unit*item.qty;

      const row=document.createElement('div');
      row.className='ld-cart-row';

      row.innerHTML=`
        <div>
          <strong>Hoodie</strong>
          <span class="ld-chip">${COLOR_NAME[item.color]}</span>
          <span class="ld-chip">${item.size}</span>
          <span class="ld-chip">${item.quality}</span>
          <span class="ld-chip">${item.motifs} Motive</span>
        </div>
        <div>${fmt(item.unit)}</div>
        <div>
          <button class="ld-btn" data-a="${i}">‚àí</button>
          <span>${item.qty}</span>
          <button class="ld-btn" data-b="${i}">+</button>
        </div>
        <button class="ld-btn" data-x="${i}">Entfernen</button>
      `;
      cartBox.appendChild(row);
    });

    totalEl.textContent=fmt(sum);

    cartBox.querySelectorAll('[data-a]').forEach(b=>{
      b.onclick=()=>{
        const idx=+b.dataset.a;
        cart[idx].qty=Math.max(1,cart[idx].qty-1);
        renderCart();
      };
    });

    cartBox.querySelectorAll('[data-b]').forEach(b=>{
      b.onclick=()=>{
        const idx=+b.dataset.b;
        cart[idx].qty++;
        renderCart();
      };
    });

    cartBox.querySelectorAll('[data-x]').forEach(b=>{
      b.onclick=()=>{
        cart.splice(+b.dataset.x,1);
        renderCart();
      };
    });
  }


  document.getElementById('ld-add').onclick=()=>{
    const size=sizeEl.value||'-';
    const qty=Math.max(1,parseInt(qtyEl.value||'1'));
    const stats=motifStats();

    const item={
      color,
      size,
      qty,
      quality:selectedQuality,
      motifs:stats.bw+stats.color,
      unit:computeUnitPrice()
    };

    cart.push(item);
    renderCart();
    updatePrice();
  };


  /* ==========================================================
     DOWNLOAD
  ========================================================== */

  document.getElementById('ld-download').onclick=()=>{
    const a=document.createElement('a');
    a.download=`HomePrint24_Hoodie_${color}_${view}.png`;
    a.href=canvas.toDataURL('image/png');
    a.click();
  };


  /* ==========================================================
     CHECKOUT
  ========================================================== */

  document.getElementById('ld-checkout').onclick=()=>{
    window.location.href="https://www.homeprint24.com/";
  };


  /* ==========================================================
     INIT
  ========================================================== */

  function init(){
    selectedQuality='standard';
    qualityEl.value='standard';
    color='white';

    renderColorSelect();
    renderSwatches();
    renderUploadRows();
    syncUI();
    updatePrice();
    draw();
    setView('front');
  }

  init();

})();
</script>
