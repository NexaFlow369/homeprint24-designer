<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>HomePrint24 – Farbtest T-Shirt</title>
  <style>
    body{
      margin:0;
      padding:20px;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      background:#e5e7eb;
      color:#0f172a;
    }
    .wrap{
      max-width:900px;
      margin:0 auto;
      background:#f9fafb;
      border-radius:16px;
      padding:16px;
      box-shadow:0 10px 30px rgba(15,23,42,.15);
    }
    h1{
      margin-top:0;
      font-size:20px;
      text-align:center;
    }
    .layout{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
    }
    .left{
      flex:1 1 320px;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    .right{
      flex:1 1 220px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    canvas{
      background:#ffffff;
      border-radius:12px;
      box-shadow:0 8px 24px rgba(15,23,42,.25);
      max-width:100%;
    }
    .controls label{
      font-weight:600;
      font-size:14px;
      display:block;
      margin-bottom:4px;
    }
    select{
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #cbd5e1;
      background:#fff;
      font-size:14px;
    }
    .swatches{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .swatch{
      width:26px;
      height:26px;
      border-radius:50%;
      border:2px solid #cbd5e1;
      cursor:pointer;
    }
    .swatch.active{
      box-shadow:0 0 0 3px rgba(37,99,235,.5);
    }
    .view-btns{
      display:flex;
      gap:8px;
      margin-top:4px;
    }
    button{
      padding:8px 12px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
    }
    .primary{
      background:#1d3557;
      color:#fff;
    }
    .ghost{
      background:#e5e7eb;
      color:#111827;
    }
    .hint{
      font-size:12px;
      color:#6b7280;
    }
  </style>
</head>
<body>

<div class="wrap">
  <h1>HomePrint24 – Farbtest nur mit 3 weißen Bildern (Front / Back / Side)</h1>
  <div class="layout">
    <div class="left">
      <canvas id="mockupCanvas" width="700" height="840"></canvas>
    </div>
    <div class="right">
      <div class="controls">
        <label>Ansicht</label>
        <div class="view-btns">
          <button id="btnFront" class="primary">Front</button>
          <button id="btnBack" class="ghost">Back</button>
          <button id="btnSide" class="ghost">Side</button>
        </div>
      </div>

      <div class="controls">
        <label>Farbe (Vorschau)</label>
        <select id="colorSelect">
          <option value="w">Weiß</option>
          <option value="s">Schwarz</option>
          <option value="r">Rot</option>
          <option value="g">Gelb</option>
          <option value="b">Blau</option>
        </select>
        <div class="swatches" id="swatches"></div>
      </div>

      <p class="hint">
        Test: nur deine 3 weißen Originalbilder.<br>
        Wir färben nur die hellen (T-Shirt-)Pixel, Hintergrund bleibt wie er ist.<br>
        Wenn das passt → später pro Produkt nur Front+Back in Weiß nötig.
      </p>
    </div>
  </div>
</div>

<script>
window.addEventListener('load', function(){
  // Deine 3 weißen Bilder
  const IMG_FRONT = "https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/IMG_9230.jpeg/:/rs=w:1440,h:1440";
  const IMG_BACK  = "https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/C9E813D3-77ED-4891-9CED-F91082A6B7F1.jpeg/:/rs=w:1440,h:1440";
  const IMG_SIDE  = "https://img1.wsimg.com/isteam/ip/b7f2d84f-ac0c-40e3-8f17-c80a8147cdc6/ols/ABC6522D-7162-43C9-BF53-2256C0E93950.jpeg/:/rs=w:1440,h:1440";

  const COLOR_HEX = {
    w:"#ffffff",
    s:"#111827",
    r:"#ef4444",
    g:"#fbbf24",
    b:"#2563eb"
  };

  const canvas = document.getElementById("mockupCanvas");
  const ctx = canvas.getContext("2d");

  const btnFront = document.getElementById("btnFront");
  const btnBack  = document.getElementById("btnBack");
  const btnSide  = document.getElementById("btnSide");
  const colorSelect = document.getElementById("colorSelect");
  const swatchesBox = document.getElementById("swatches");

  let currentView  = "front"; // front | back | side
  let currentColor = "w";     // w | s | r | g | b

  const CACHE = {};

  function loadImage(url, cb){
    if(CACHE[url] && CACHE[url].complete){
      cb(CACHE[url]);
      return;
    }
    const img = new Image();
    img.onload = function(){
      CACHE[url] = img;
      cb(img);
    };
    img.src = url; // kein crossOrigin – Anzeige reicht
  }

  function hexToRgb(hex){
    hex = hex.replace("#","");
    if(hex.length === 3){
      hex = hex.split("").map(c=>c+c).join("");
    }
    const num = parseInt(hex,16);
    return{
      r:(num>>16)&255,
      g:(num>>8)&255,
      b:num&255
    };
  }

  function getImageForView(){
    if(currentView === "front") return IMG_FRONT;
    if(currentView === "back")  return IMG_BACK;
    return IMG_SIDE;
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const url = getImageForView();
    loadImage(url, function(base){
      // Bild auf Canvas zentrieren
      const marginX = canvas.width*0.08;
      const marginY = canvas.height*0.06;
      const maxW = canvas.width - marginX*2;
      const maxH = canvas.height - marginY*2;

      const ratio = base.height / base.width;
      let W = maxW;
      let H = W * ratio;
      if(H > maxH){
        H = maxH;
        W = H / ratio;
      }
      const sx = (canvas.width - W)/2;
      const sy = (canvas.height - H)/2;

      ctx.drawImage(base, sx, sy, W, H);

      // Weiß lassen = keine Färbung
      if(currentColor === "w") return;

      // Pixel holen nur aus dem Bereich des Shirts (Bildfläche)
      const imgData = ctx.getImageData(sx, sy, W, H);
      const data = imgData.data;

      const target = hexToRgb(COLOR_HEX[currentColor]);
      const strength = 0.9; // wie stark die neue Farbe reindrückt (0–1)

      for(let i=0;i<data.length;i+=4){
        const r = data[i];
        const g = data[i+1];
        const b = data[i+2];

        // "nahe weiß" erkennen: Shirt
        const max = Math.max(r,g,b);
        const min = Math.min(r,g,b);
        const isBright = max > 210;          // hell
        const lowContrast = (max-min) < 25;  // wenig Farbe → eher weiß/grau

        if(isBright && lowContrast){
          // nur diese Pixel in Ziel-Farbe ziehen
          data[i]   = r*(1-strength) + target.r*strength;
          data[i+1] = g*(1-strength) + target.g*strength;
          data[i+2] = b*(1-strength) + target.b*strength;
        }
      }

      ctx.putImageData(imgData, sx, sy);
    });
  }

  function setView(v){
    currentView = v;
    btnFront.className = (v==="front") ? "primary" : "ghost";
    btnBack.className  = (v==="back")  ? "primary" : "ghost";
    btnSide.className  = (v==="side")  ? "primary" : "ghost";
    draw();
  }

  function renderSwatches(){
    swatchesBox.innerHTML = "";
    ["w","s","r","g","b"].forEach(key=>{
      const div = document.createElement("div");
      div.className = "swatch" + (key===currentColor ? " active" : "");
      div.style.background = COLOR_HEX[key];
      div.title = key.toUpperCase();
      div.addEventListener("click", function(){
        currentColor = key;
        colorSelect.value = key;
        renderSwatches();
        draw();
      });
      swatchesBox.appendChild(div);
    });
  }

  // Events
  btnFront.addEventListener("click", ()=>setView("front"));
  btnBack.addEventListener("click",  ()=>setView("back"));
  btnSide.addEventListener("click",  ()=>setView("side"));

  colorSelect.addEventListener("change", function(e){
    currentColor = e.target.value;
    renderSwatches();
    draw();
  });

  // Init
  renderSwatches();
  setView("front");
});
</script>

</body>
</html>
